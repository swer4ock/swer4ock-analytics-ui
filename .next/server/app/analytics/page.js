(()=>{var e={};e.id=109,e.ids=[109],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4508:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>c}),s(2388),s(2029),s(5866);var r=s(3191),n=s(8716),i=s(7922),o=s.n(i),a=s(5231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);s.d(t,l);let c=["",{children:["analytics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2388)),"/Users/macbookpro/Desktop/defires/yandex_market/telefon_1/swer4ock-analytics-ui/src/app/analytics/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"/Users/macbookpro/Desktop/defires/yandex_market/telefon_1/swer4ock-analytics-ui/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/macbookpro/Desktop/defires/yandex_market/telefon_1/swer4ock-analytics-ui/src/app/analytics/page.tsx"],p="/analytics/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/analytics/page",pathname:"/analytics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7698:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},5303:()=>{},2388:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,dynamic:()=>n});var r=s(9510);let n="force-dynamic";async function i(e,t){let s=`https://uumrjikuqewlakczbnbs.supabase.co/rest/v1/rpc/${e}`,r="sb_publishable_sfsDkZToPxhGJC8-WdwoiQ_ZMNTcW6m",n=await fetch(s,{method:"POST",headers:{apikey:r,Authorization:`Bearer ${r}`,"Content-Type":"application/json",Prefer:"count=none"},body:t?JSON.stringify(t):"{}",next:{revalidate:0}});if(!n.ok){let t=await n.text();throw Error(`RPC ${e} failed: ${n.status} ${t}`)}return n.json()}async function o(){let e=[],t=[],s=[];try{e=await i("get_analytics_summary")}catch(e){console.error(e)}try{t=await i("get_city_performance",{p_limit:20})}catch(e){console.error(e)}try{s=await i("get_strategy_monitoring",{p_limit:50})}catch(e){console.error(e)}let n=e?.[0];return(0,r.jsxs)("main",{style:{padding:"24px",maxWidth:1200,margin:"0 auto",fontFamily:"sans-serif"},children:[r.jsx("h1",{style:{fontSize:28,marginBottom:16},children:"Аналитика (MVP, RPC Supabase)"}),(0,r.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:24},children:[(0,r.jsxs)("div",{style:l,children:[r.jsx("div",{style:c,children:"Объявления"}),r.jsx("div",{style:d,children:n?.total_ads??"—"})]}),(0,r.jsxs)("div",{style:l,children:[r.jsx("div",{style:c,children:"Города"}),r.jsx("div",{style:d,children:n?.total_cities??"—"})]}),(0,r.jsxs)("div",{style:l,children:[r.jsx("div",{style:c,children:"Контакты (sum)"}),r.jsx("div",{style:d,children:n?.total_contacts??"—"})]}),(0,r.jsxs)("div",{style:l,children:[r.jsx("div",{style:c,children:"Конверсия, % (avg)"}),r.jsx("div",{style:d,children:n?.avg_conversion?`${n.avg_conversion.toFixed(1)}%`:"—"})]})]}),(0,r.jsxs)("section",{style:{marginBottom:32},children:[r.jsx("h2",{style:{fontSize:20,marginBottom:8},children:"Производительность по городам (топ 20)"}),r.jsx(a,{columns:["Город","Показы","Просмотры","Контакты","Конверсия, %"],rows:t.map(e=>[e.city,e.impressions,e.views,e.contacts,e.view_to_contact])})]}),(0,r.jsxs)("section",{children:[r.jsx("h2",{style:{fontSize:20,marginBottom:8},children:"Мониторинг стратегий автобиддера"}),r.jsx(a,{columns:["Стратегия","Объявлений","Ср. цена контакта","Ср. конверсия, %"],rows:s.map(e=>[e.strategy_type,e.ads_count,e.avg_cost_per_contact,e.avg_conversion])})]}),(0,r.jsxs)("div",{style:{marginTop:24,color:"#666",fontSize:12},children:["Обновлено: ",n?.refreshed_at?new Date(n.refreshed_at).toLocaleString():"—"]})]})}function a({columns:e,rows:t}){return r.jsx("div",{style:{overflowX:"auto",border:"1px solid #eee",borderRadius:8},children:(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsx("tr",{children:e.map((e,t)=>r.jsx("th",{style:p,children:e},t))})}),r.jsx("tbody",{children:0===t.length?r.jsx("tr",{children:r.jsx("td",{colSpan:e.length,style:{padding:16,textAlign:"center",color:"#888"},children:"нет данных"})}):t.map((e,t)=>r.jsx("tr",{children:e.map((e,t)=>r.jsx("td",{style:x,children:e??"—"},t))},t))})]})})}let l={border:"1px solid #eee",borderRadius:12,padding:"12px 16px",background:"#fafafa"},c={fontSize:12,color:"#666",marginBottom:6},d={fontSize:22,fontWeight:700},p={textAlign:"left",padding:"10px 12px",borderBottom:"1px solid #eee",background:"#fafafa",fontSize:12,color:"#444"},x={padding:"10px 12px",borderBottom:"1px solid #f2f2f2",fontSize:13}},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>n});var r=s(9510);let n={title:"swer4ock analytics"};function i({children:e}){return r.jsx("html",{lang:"ru",children:r.jsx("body",{style:{margin:0,fontFamily:"system-ui, sans-serif"},children:e})})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[819],()=>s(4508));module.exports=r})();