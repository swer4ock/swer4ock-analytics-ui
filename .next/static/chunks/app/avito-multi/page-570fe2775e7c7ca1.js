(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[527],{8814:function(e,t,r){Promise.resolve().then(r.bind(r,9748))},6463:function(e,t,r){"use strict";var i=r(1169);r.o(i,"useRouter")&&r.d(t,{useRouter:function(){return i.useRouter}}),r.o(i,"useSearchParams")&&r.d(t,{useSearchParams:function(){return i.useSearchParams}})},9748:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a},dynamic:function(){return s}});var i=r(7437),n=r(2265),o=r(6463),l=r(4923);let s="force-dynamic";function d(){let e=(0,o.useSearchParams)(),t=(0,o.useRouter)(),[r,s]=(0,n.useState)("seltka"),[d,a]=(0,n.useState)(7),[c,u]=(0,n.useState)(""),[h,f]=(0,n.useState)(null),[p,x]=(0,n.useState)(null),[g,y]=(0,n.useState)(null),[m,b]=(0,n.useState)(null);(0,n.useEffect)(()=>{let t=e.get("company")||void 0,r=e.get("days"),i=e.get("city")||void 0;t&&s(t),r&&!Number.isNaN(Number(r))&&a(Number(r)),i&&u(i)},[]),(0,n.useEffect)(()=>{let e=new URLSearchParams;e.set("company",r),e.set("days",String(d)),c.trim()&&e.set("city",c.trim());let i=e.toString();t.replace("/avito-multi?".concat(i))},[r,d,c,t]),(0,n.useEffect)(()=>{let e=!0;return(async()=>{try{b(null),f(null),x(null),y(null);let t=c.trim()?c.trim():void 0,[i,n,o]=await Promise.all([(0,l.WW)("get_avito_contacts",{p_company:r,p_days:d,p_city:t}),(0,l.WW)("get_avito_cpl_by_strategy",{p_company:r,p_days:d}),(0,l.WW)("get_avito_top_cities_sales",{p_limit:10})]);if(!e)return;f(i),x(n),y(o)}catch(t){if(!e)return;console.error("Avito Multi load error:",t),b(String((null==t?void 0:t.message)||t)),f([]),x([]),y([])}})(),()=>{e=!1}},[r,d,c]);let j=null===h||null===p||null===g,v=n.useMemo(()=>(h||[]).reduce((e,t)=>e+(t.contacts||0),0),[h]),_=n.useMemo(()=>(g||[]).length,[g]),S=n.useMemo(()=>{let e=(p||[]).filter(e=>null!==e.cpl);return 0===e.length?null:e.reduce((e,t)=>e.cpl<t.cpl?e:t)},[p]);return(0,i.jsxs)("main",{style:{padding:24,maxWidth:1400,margin:"0 auto",fontFamily:"system-ui, sans-serif"},children:[(0,i.jsx)("h1",{style:{fontSize:28,fontWeight:700,marginBottom:8},children:"\uD83D\uDCCA Avito Мульти-компания (реальные данные через Supabase RPC)"}),(0,i.jsx)("p",{style:{color:"#6c757d",marginBottom:16},children:"Анализ данных по нескольким компаниям с реальными данными из Supabase."}),(0,i.jsxs)("section",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginBottom:20},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"company",style:{display:"block",fontSize:12,color:"#555"},children:"Компания"}),(0,i.jsx)("select",{id:"company",value:r,onChange:e=>s(e.target.value),style:{padding:"6px 10px",border:"1px solid #e1e1e1",borderRadius:6},children:[{value:"seltka",label:"Сэлтка (Кирилл)"},{value:"iltech",label:"Ильтех (Ильнур)"},{value:"mituroom",label:"mituroom (Артем)"}].map(e=>(0,i.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"days",style:{display:"block",fontSize:12,color:"#555"},children:"Дней"}),(0,i.jsxs)("select",{id:"days",value:d,onChange:e=>a(Number(e.target.value)),style:{padding:"6px 10px",border:"1px solid #e1e1e1",borderRadius:6},children:[(0,i.jsx)("option",{value:7,children:"7"}),(0,i.jsx)("option",{value:14,children:"14"}),(0,i.jsx)("option",{value:30,children:"30"}),(0,i.jsx)("option",{value:60,children:"60"}),(0,i.jsx)("option",{value:90,children:"90"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"city",style:{display:"block",fontSize:12,color:"#555"},children:"Город (опц.)"}),(0,i.jsx)("input",{id:"city",value:c,onChange:e=>u(e.target.value),placeholder:"например, Казань",style:{padding:"6px 10px",border:"1px solid #e1e1e1",borderRadius:6}})]})]}),j&&(0,i.jsx)("div",{style:{padding:16,color:"#6c757d"},children:"Загрузка данных…"}),m&&(0,i.jsxs)("div",{style:{padding:16,color:"#721c24",background:"#f8d7da",border:"1px solid #f5c6cb",borderRadius:8,marginBottom:16},children:["Ошибка: ",m]}),!j&&!m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("section",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:20},children:[(0,i.jsxs)("div",{style:{background:"#fff",border:"1px solid #eee",borderRadius:8,padding:16},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#666"},children:"Всего контактов"}),(0,i.jsx)("div",{style:{fontSize:24,fontWeight:700},children:v.toLocaleString("ru-RU")})]}),(0,i.jsxs)("div",{style:{background:"#fff",border:"1px solid #eee",borderRadius:8,padding:16},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#666"},children:"Городов в топ-таблице"}),(0,i.jsx)("div",{style:{fontSize:24,fontWeight:700},children:_})]}),(0,i.jsxs)("div",{style:{background:"#fff",border:"1px solid #eee",borderRadius:8,padding:16},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#666"},children:"Лучшая стратегия по CPL"}),(0,i.jsx)("div",{style:{fontSize:24,fontWeight:700},children:S?"".concat(S.strategy," (").concat(Math.round(S.cpl||0)," ₽)"):"—"})]})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{style:{fontSize:18,fontWeight:700,marginBottom:8},children:"Топ городов по контактам"}),(0,i.jsx)("div",{style:{overflowX:"auto",background:"#fff",border:"1px solid #eee",borderRadius:8},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{background:"#f8f9fa"},children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid #eee"},children:"Город"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:8,borderBottom:"1px solid #eee"},children:"Контакты"})]})}),(0,i.jsx)("tbody",{children:(g||[]).map((e,t)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1"},children:e.city}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1",textAlign:"right"},children:e.contacts.toLocaleString("ru-RU")})]},"".concat(e.city,"-").concat(t)))})]})})]}),(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{style:{fontSize:18,fontWeight:700,marginBottom:8},children:"CPL по стратегиям"}),(0,i.jsx)("div",{style:{overflowX:"auto",background:"#fff",border:"1px solid #eee",borderRadius:8},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{background:"#f8f9fa"},children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid #eee"},children:"Стратегия"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:8,borderBottom:"1px solid #eee"},children:"Контакты"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:8,borderBottom:"1px solid #eee"},children:"Затраты (₽)"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:8,borderBottom:"1px solid #eee"},children:"CPL (₽)"})]})}),(0,i.jsx)("tbody",{children:(p||[]).map((e,t)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1"},children:e.strategy}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1",textAlign:"right"},children:e.contacts.toLocaleString("ru-RU")}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1",textAlign:"right"},children:Math.round(e.cost).toLocaleString("ru-RU")}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1",textAlign:"right"},children:null!==e.cpl?Math.round(e.cpl).toLocaleString("ru-RU"):"—"})]},"".concat(e.strategy,"-").concat(t)))})]})})]})]}),(0,i.jsxs)("section",{style:{marginTop:16},children:[(0,i.jsxs)("h2",{style:{fontSize:18,fontWeight:700,marginBottom:8},children:["Недавние контакты (последние ",d," дн.) ",c.trim()?"— ".concat(c.trim()):""]}),(0,i.jsx)("div",{style:{overflowX:"auto",background:"#fff",border:"1px solid #eee",borderRadius:8},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{background:"#f8f9fa"},children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid #eee"},children:"Дата"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid #eee"},children:"Город"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid #eee"},children:"Объявление"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:8,borderBottom:"1px solid #eee"},children:"Контакты"})]})}),(0,i.jsx)("tbody",{children:(h||[]).map((e,t)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1"},children:new Date(e.date).toLocaleDateString("ru-RU")}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1"},children:e.city}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1"},children:e.ad_id}),(0,i.jsx)("td",{style:{padding:8,borderBottom:"1px solid #f1f1f1",textAlign:"right"},children:e.contacts.toLocaleString("ru-RU")})]},"".concat(e.ad_id,"-").concat(e.date,"-").concat(t)))})]})})]})]})]})}function a(){return(0,i.jsx)(n.Suspense,{fallback:(0,i.jsx)("div",{style:{padding:32,textAlign:"center",color:"#6c757d"},children:"Загрузка..."}),children:(0,i.jsx)(d,{})})}},4923:function(e,t,r){"use strict";async function i(e,t){let r="".concat("https://uumrjikuqewlakczbnbs.supabase.co","/rest/v1/rpc/").concat(e),i="sb_publishable_sfsDkZToPxhGJC8-WdwoiQ_ZMNTcW6m",n=await fetch(r,{method:"POST",headers:{apikey:i,Authorization:"Bearer ".concat(i),"Content-Type":"application/json",Prefer:"count=none"},body:t?JSON.stringify(t):"{}",next:{revalidate:0},cache:"no-store"});if(!n.ok){let t=await n.text(),r=Error("RPC ".concat(e," failed: ").concat(n.status," ").concat(t));throw r.status=n.status,r}return n.json()}async function n(e,t){let r=async e=>{try{return await i(e,t)}catch(e){throw e}};try{return await r("".concat(e,"_v1"))}catch(l){var n;let t=String(null!==(n=null==l?void 0:l.message)&&void 0!==n?n:l),i=null==l?void 0:l.status,o=t.includes("PGRST203")||t.includes("Could not choose the best candidate function");if(404===i||405===i||o)return await r(e);throw l}}async function o(e){return n("get_avito_cpl_by_strategy",e)}async function l(e){return n("get_avito_top_cities_sales",e)}async function s(e){return n("get_unified_ads_performance",e)}async function d(e){return n("get_avito_positions_analysis",e)}async function a(e){return n("get_geo_profitability_analysis",e)}async function c(e){return n("get_optimization_recommendations",e)}r.d(t,{MI:function(){return l},Q6:function(){return d},Rn:function(){return o},Ue:function(){return s},WW:function(){return n},jf:function(){return c},xL:function(){return a}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=8814)}),_N_E=e.O()}]);